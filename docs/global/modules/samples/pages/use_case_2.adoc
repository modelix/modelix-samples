= Use case 2: Model server and web frontend
:navtitle: 2. Model server and web frontend

This use case realizes the synchronization of model data between two web frontends and a model server.
Optionally, an MPS project can be run and also synchronize its model data with the model server.

One web frontend is the *Management application* implemented in Vue.js.
It can be used to edit the model content.
It uses the https://artifacts.itemis.cloud/service/rest/repository/browse/npm-open/%40modelix/model-client/[@modelix/model-client], the https://artifacts.itemis.cloud/service/rest/repository/browse/npm-open/%40modelix/vue-model-api/[@modelix/vue-model-api] and code generated by the  xref:core:reference/component-model-api-gen-gradle.adoc[Model API generator].
The generated code provides type-safe access to model data and is derived from the xref:metamodel.adoc[MPS languages under `mps/languages`].

The other web frontend is the *Overview application* and is implemented in Angular.
It displays an overview of model data.
It also uses the `model-client` and the generated type-safe TypeScript API.

A running MPS projects syncs model data using the https://artifacts.itemis.cloud/service/rest/repository/browse/maven-mps/org/modelix/mps/model-server-sync-plugin/[model-server-sync-plugin].

NOTE: The web frontends communicate directly with a model server and not through an intermediary custom backend like in xref:overview.adoc#use_case_3[use case 3].

NOTE: Take a look at the xref:overview.adoc[overview] to understand how this use case relates to the other use cases.

== Demonstration

.Demonstration of synchronization
image::use_case_2.gif[]

.Interactions in demonstration
image::use_case_2_sequence.svg[Static,1920]
// [Static,1920] is specifying how the SVG should be shown
// see. https://docs.asciidoctor.org/asciidoc/latest/macros/image-svg/

// Mermaid source. Edit with https://mermaid.live/
// sequenceDiagram
//     actor back-office
//     actor student
//     actor tutor
//     tutor->>Management application: make change
//     Management application-->>tutor: display change
//     Management application->>Model server: propagate change
//     Model server-->>Management application:
//     Model server->>Overview application: propagate change
//     Overview application-->>Model server:
//     Overview application-->>student: display change
//     Model server->>MPS: propagate change
//     MPS-->>Model server:
//     MPS-->>back-office: display change
//     back-office->>MPS: make change
//     MPS-->>back-office: display change
//     MPS->>Model server: propagate change
//     Model server-->>MPS:
//     Model server->>Overview application: propagate change
//     Overview application-->>Model server:
//     Overview application-->>student: display change
//     Model server->>Management application: propagate change
//     Management application-->>Model server:
//     Management application-->>tutor: display change

In this demonstration

1. Model data is edited through the *Management application*.
2. Those changes are then synced to the *Overview application* and MPS through the model server.
3. Model data is edited again in MPS by reverting the made changes.
4. Those changes are then also synced back.

== Instructions

You can try the demo yourself by downloading the https://github.com/modelix/modelix.samples/[samples repository].

In the downloaded repository, use Gradle to build the relevant components.

.Command to build needed components
[source,shell]
----
./gradlew spa-management-vue:build spa-overview-angular:build mps:project-modelserver-backend:build
----

This command

* Installs dependencies in the MPS project `mps/project-modelserver-backend`.
+
The main dependency is the https://artifacts.itemis.cloud/service/rest/repository/browse/maven-mps/org/modelix/mps/model-server-sync-plugin/[model-server-sync-plugin].
* Generates TypeScript sources in `mps/metamodel-api-ts`.
+
Those sources are  generated from the xref:metamodel.adoc[MPS languages] in `mps/languages`.
They are used in the `spa-management-vue` and `spa-overview-angular`.
* Builds the Single-page applications `spa-management-vue` and `spa-overview-angular`.

Start the components:

[source,shell]
----
docker-compose --profile useCase2 up
----

This starts

* a xref:core:reference/component-model-server.adoc[model server] with initial data under http://localhost:28101/
* the *Management application* at http://localhost:3000/
* the *Overview application* at http://localhost:4200/

=== MPS (optionally)

Start MPS 2021.2.6  without any global plugins and open the project in the `mps/project-mps-backend` folder.

This MPS project has a plugin installed and configured to sync the model content automatically with the model server.

xref:use_case_1.adoc[Use case 1] describes the synchronization between a model client and an MPS instance.
